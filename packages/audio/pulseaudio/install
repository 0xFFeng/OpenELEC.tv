#!/bin/sh

. config/options $1

# add_user pulse x 499 498 "PulseAudio System Daemon" "/var/run/pulse" "/bin/sh"
# add_group pulse 498
# add_group pulse-access 497

mkdir -p $INSTALL_SYSTEM/etc/dbus-1/system.d
  cp $PKG_BUILD/src/daemon/pulseaudio-system.conf $INSTALL_SYSTEM/etc/dbus-1/system.d
  sed -e 's%user="pulse"%user="root"%g' -i $INSTALL_SYSTEM/etc/dbus-1/system.d/pulseaudio-system.conf

mkdir -p $INSTALL_SYSTEM/etc
  cp $PKG_DIR/config/asound.conf $INSTALL_SYSTEM/etc

mkdir -p $INSTALL_SYSTEM/etc/alsa
  cp $PKG_DIR/config/pulse-default.conf $INSTALL_SYSTEM/etc/alsa

mkdir -p $INSTALL_SYSTEM/etc/pulse
  cp $PKG_BUILD/src/client.conf $INSTALL_SYSTEM/etc/pulse
  cp $PKG_BUILD/src/daemon.conf $INSTALL_SYSTEM/etc/pulse
#  cp $PKG_BUILD/src/default.pa $INSTALL_SYSTEM/etc/pulse
#  cp $PKG_DIR/config/default.pa $INSTALL_SYSTEM/etc/pulse
  cp $PKG_BUILD/src/system.pa $INSTALL_SYSTEM/etc/pulse

mkdir -p $INSTALL_SYSTEM/lib/udev/rules.d
  cp $PKG_BUILD/src/modules/alsa/mixer/profile-sets/90-pulseaudio.rules $INSTALL_SYSTEM/lib/udev/rules.d

mkdir -p $INSTALL_SYSTEM/bin
  cp $PKG_BUILD/src/.libs/pacat $INSTALL_SYSTEM/bin
  cp $PKG_BUILD/src/.libs/pacmd $INSTALL_SYSTEM/bin
  cp $PKG_BUILD/src/.libs/pactl $INSTALL_SYSTEM/bin
  ln -sf pactl $INSTALL_SYSTEM/bin/pamon
  ln -sf pactl $INSTALL_SYSTEM/bin/paplay
  ln -sf pactl $INSTALL_SYSTEM/bin/parec
  ln -sf pactl $INSTALL_SYSTEM/bin/parecord
  cp $PKG_BUILD/src/.libs/pasuspender $INSTALL_SYSTEM/bin
#  cp $PKG_BUILD/src/.libs/pax11publish $INSTALL_SYSTEM/bin
  cp $PKG_BUILD/src/.libs/pulseaudio $INSTALL_SYSTEM/bin
#  cp $PKG_BUILD/src/start-pulseaudio-x11 $INSTALL_SYSTEM/bin

mkdir -p $INSTALL_SYSTEM/lib
  cp -P $PKG_BUILD/src/.libs/libpulse*.so* $INSTALL_SYSTEM/lib
  rm -rf $INSTALL_SYSTEM/lib/libpulse*.so*T

mkdir -p $INSTALL_SYSTEM/lib/pulse
  cp -P $PKG_BUILD/src/.libs/libalsa-util.so $INSTALL_SYSTEM/lib/pulse
  cp -P $PKG_BUILD/src/.libs/libavahi-wrap.so $INSTALL_SYSTEM/lib/pulse
  cp -P $PKG_BUILD/src/.libs/libcli.so $INSTALL_SYSTEM/lib/pulse
  cp -P $PKG_BUILD/src/.libs/libprotocol-cli.so $INSTALL_SYSTEM/lib/pulse
  cp -P $PKG_BUILD/src/.libs/libprotocol-esound.so $INSTALL_SYSTEM/lib/pulse
  cp -P $PKG_BUILD/src/.libs/libprotocol-http.so $INSTALL_SYSTEM/lib/pulse
  cp -P $PKG_BUILD/src/.libs/libprotocol-native.so $INSTALL_SYSTEM/lib/pulse
  cp -P $PKG_BUILD/src/.libs/libprotocol-simple.so $INSTALL_SYSTEM/lib/pulse
  cp -P $PKG_BUILD/src/.libs/libraop.so $INSTALL_SYSTEM/lib/pulse
  cp -P $PKG_BUILD/src/.libs/librtp.so $INSTALL_SYSTEM/lib/pulse
  cp -P $PKG_BUILD/src/.libs/module-*.so $INSTALL_SYSTEM/lib/pulse

mkdir -p $INSTALL_SYSTEM/share/pulseaudio/alsa-mixer/paths
  cp $PKG_BUILD/src/modules/alsa/mixer/paths/* $INSTALL_SYSTEM/share/pulseaudio/alsa-mixer/paths

mkdir -p $INSTALL_SYSTEM/share/pulseaudio/alsa-mixer/profile-sets
  cp $PKG_BUILD/src/modules/alsa/mixer/profile-sets/*.conf $INSTALL_SYSTEM/share/pulseaudio/alsa-mixer/profile-sets
