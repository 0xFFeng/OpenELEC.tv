#!/bin/sh

################################################################################
#      This file is part of OpenELEC - http://www.openelec.tv
#      Copyright (C) 2009-2011 Stephan Raue (stephan@openelec.tv)
#
#  This Program is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 2, or (at your option)
#  any later version.
#
#  This Program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with OpenELEC.tv; see the file COPYING.  If not, write to
#  the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
#  http://www.gnu.org/copyleft/gpl.html
################################################################################

. config/options $1

mkdir -p $INSTALL_SYSTEM/etc/pm/config.d
  cp $PKG_DIR/config.d/* $INSTALL_SYSTEM/etc/pm/config.d || true
mkdir -p $INSTALL_SYSTEM/etc/pm/power.d
  cp $PKG_DIR/power.d/* $INSTALL_SYSTEM/etc/pm/power.d || true
mkdir -p $INSTALL_SYSTEM/etc/pm/sleep.d
  cp $PKG_DIR/sleep.d/* $INSTALL_SYSTEM/etc/pm/sleep.d || true

mkdir -p $INSTALL_SYSTEM/bin
  cp $PKG_BUILD/src/on_ac_power $INSTALL_SYSTEM/bin
  cp $PKG_BUILD/src/pm-is-supported $INSTALL_SYSTEM/bin

mkdir -p $INSTALL_SYSTEM/lib/pm-utils/
  cp $PKG_BUILD/pm/defaults $INSTALL_SYSTEM/lib/pm-utils
  cp $PKG_BUILD/pm/functions $INSTALL_SYSTEM/lib/pm-utils
  cp $PKG_BUILD/pm/pm-functions $INSTALL_SYSTEM/lib/pm-utils

mkdir -p $INSTALL_SYSTEM/lib/pm-utils/bin
  cp $PKG_BUILD/src/pm-action $INSTALL_SYSTEM/lib/pm-utils/bin
  cp $PKG_BUILD/src/pm-pmu $INSTALL_SYSTEM/lib/pm-utils/bin
  cp $PKG_BUILD/src/pm-reset-swap $INSTALL_SYSTEM/lib/pm-utils/bin
  cp $PKG_BUILD/src/service $INSTALL_SYSTEM/lib/pm-utils/bin

mkdir -p $INSTALL_SYSTEM/lib/pm-utils/module.d
  cp $PKG_BUILD/pm/module.d/kernel $INSTALL_SYSTEM/lib/pm-utils/module.d
  cp $PKG_BUILD/pm/module.d/uswsusp $INSTALL_SYSTEM/lib/pm-utils/module.d
  cp $PKG_BUILD/pm/module.d/tuxonice $INSTALL_SYSTEM/lib/pm-utils/module.d

mkdir -p $INSTALL_SYSTEM/lib/pm-utils/power.d
  cp $PKG_BUILD/pm/power.d/disable_wol $INSTALL_SYSTEM/lib/pm-utils/power.d
  cp $PKG_BUILD/pm/power.d/harddrive $INSTALL_SYSTEM/lib/pm-utils/power.d
  cp $PKG_BUILD/pm/power.d/hal-cd-polling $INSTALL_SYSTEM/lib/pm-utils/power.d
  cp $PKG_BUILD/pm/power.d/journal-commit $INSTALL_SYSTEM/lib/pm-utils/power.d
  cp $PKG_BUILD/pm/power.d/intel-audio-powersave $INSTALL_SYSTEM/lib/pm-utils/power.d
  cp $PKG_BUILD/pm/power.d/pcie_aspm $INSTALL_SYSTEM/lib/pm-utils/power.d
  cp $PKG_BUILD/pm/power.d/laptop-mode $INSTALL_SYSTEM/lib/pm-utils/power.d
  cp $PKG_BUILD/pm/power.d/sata_alpm $INSTALL_SYSTEM/lib/pm-utils/power.d
  cp $PKG_BUILD/pm/power.d/readahead $INSTALL_SYSTEM/lib/pm-utils/power.d
  cp $PKG_BUILD/pm/power.d/sched-powersave $INSTALL_SYSTEM/lib/pm-utils/power.d
  cp $PKG_BUILD/pm/power.d/wireless $INSTALL_SYSTEM/lib/pm-utils/power.d
  cp $PKG_BUILD/pm/power.d/xfs_buffer $INSTALL_SYSTEM/lib/pm-utils/power.d
  chmod +x $INSTALL_SYSTEM/lib/pm-utils/power.d/*

mkdir -p $INSTALL_SYSTEM/lib/pm-utils/sleep.d
  cp $PKG_BUILD/pm/sleep.d/00logging $INSTALL_SYSTEM/lib/pm-utils/sleep.d
  cp $PKG_BUILD/pm/sleep.d/00powersave $INSTALL_SYSTEM/lib/pm-utils/sleep.d
  cp $PKG_BUILD/pm/sleep.d/01grub $INSTALL_SYSTEM/lib/pm-utils/sleep.d
  cp $PKG_BUILD/pm/sleep.d/49bluetooth $INSTALL_SYSTEM/lib/pm-utils/sleep.d
  cp $PKG_BUILD/pm/sleep.d/55NetworkManager $INSTALL_SYSTEM/lib/pm-utils/sleep.d
  cp $PKG_BUILD/pm/sleep.d/75modules $INSTALL_SYSTEM/lib/pm-utils/sleep.d
  cp $PKG_BUILD/pm/sleep.d/90clock $INSTALL_SYSTEM/lib/pm-utils/sleep.d
  cp $PKG_BUILD/pm/sleep.d/94cpufreq $INSTALL_SYSTEM/lib/pm-utils/sleep.d
  cp $PKG_BUILD/pm/sleep.d/95led $INSTALL_SYSTEM/lib/pm-utils/sleep.d
  cp $PKG_BUILD/pm/sleep.d/98video-quirk-db-handler $INSTALL_SYSTEM/lib/pm-utils/sleep.d
  cp $PKG_BUILD/pm/sleep.d/99video $INSTALL_SYSTEM/lib/pm-utils/sleep.d
  chmod +x $INSTALL_SYSTEM/lib/pm-utils/sleep.d/*

mkdir -p $INSTALL_SYSTEM/lib/pm-utils/video-quirks/
  cp $PKG_DIR/quirks/*.quirkdb $INSTALL_SYSTEM/lib/pm-utils/video-quirks/

mkdir -p $INSTALL_SYSTEM/sbin
  cp $PKG_BUILD/src/pm-powersave $INSTALL_SYSTEM/sbin
    ln -sf /usr/lib/pm-utils/bin/pm-action $INSTALL_SYSTEM/sbin/pm-hibernate
    ln -sf /usr/lib/pm-utils/bin/pm-action $INSTALL_SYSTEM/sbin/pm-suspend
    ln -sf /usr/lib/pm-utils/bin/pm-action $INSTALL_SYSTEM/sbin/pm-suspend-hybrid
